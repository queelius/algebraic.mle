<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="algebraic.mle">
<title>Analysis of simple time series data • algebraic.mle</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analysis of simple time series data">
<meta property="og:description" content="algebraic.mle">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">algebraic.mle</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/algebraic-mle.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/exponential-mle.html">Exponential distribution MLE</a>
    <a class="dropdown-item" href="../articles/normal-mle.html">Normal distribution MLE</a>
    <a class="dropdown-item" href="../articles/weibull-mle.html">Analysis of simple time series data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/queelius/algebraic.mle/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="weibull-mle_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Analysis of simple time series data</h1>
                        <h4 data-toc-skip class="author">Alex Towell</h4>
            
            <h4 data-toc-skip class="date">2022-10-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/queelius/algebraic.mle/blob/HEAD/vignettes/weibull-mle.Rmd" class="external-link"><code>vignettes/weibull-mle.Rmd</code></a></small>
      <div class="d-none name"><code>weibull-mle.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>We are interested in the generative process that gave rise to the data we observed. In the real world, systems are quite complex, but we settle for simpler models for analytical tractability. So, we usually assume:</p>
<ol style="list-style-type: decimal">
<li><p>The sample is i.i.d.</p></li>
<li><p>The observations may be reasonably modeled by some relatively simple process.</p></li>
<li><p>Other factors, like ambient temperature, are either negligible or are more or less constant in the sample.</p></li>
</ol>
<p>Since this is a simulation, we know the underlying DGP (data generating process). It’s just <span class="math display">\[
    T_i = W_i + \epsilon_i
\]</span> where <span class="math display">\[
    W_i \sim \operatorname{weibull}(k,\lambda)
\]</span> and <span class="math display">\[
    \epsilon_i \sim \operatorname{normal}(0,\sigma).
\]</span></p>
<p>In the real world, we do not know the DGP. In this study, we will assume that either <span class="math inline">\(T_1,\ldots,T_n\)</span> comes from Weibull or Normal. Clearly, the true DGF is a bit more complicated but still very simple compared to a more realistic DGP.</p>
<p>Then, the process of parametrically modeling the observed data may take the following steps:</p>
<ol style="list-style-type: decimal">
<li><p>Visualize the data, e.g., plot a histogram of the data.</p></li>
<li><p>Guess which parametric distribution (for the components) might fit the observed data for the system lifetime.</p></li>
<li><p>Use a statistical test for goodness-of-fit.</p></li>
<li><p>Repeat steps 2 and 3 if the measure of goodness of fit is not satisfactory.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="simulation-parameters-and-generation">Simulation parameters and generation<a class="anchor" aria-label="anchor" href="#simulation-parameters-and-generation"></a>
</h2>
<p>The simulation parameters are given by:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://optimizer.r-forge.r-project.org/" class="external-link">numDeriv</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">stats</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim.n</span> <span class="op">&lt;-</span> <span class="fl">58</span></span>
<span><span class="va">sim.err.sd</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="va">sim.shape</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">sim.scale</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">sim.theta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim.shape</span>,<span class="va">sim.scale</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span></code></pre></div>
<p>We generate the data with the following R code:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>lifetime<span class="op">=</span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html" class="external-link">rweibull</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">sim.n</span>,</span>
<span>                                   shape<span class="op">=</span><span class="va">sim.shape</span>,</span>
<span>                                   scale<span class="op">=</span><span class="va">sim.scale</span><span class="op">)</span> <span class="op">+</span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">sim.n</span>,</span>
<span>                           mean<span class="op">=</span><span class="fl">0</span>,</span>
<span>                           sd<span class="op">=</span><span class="va">sim.err.sd</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dgp.density</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html" class="external-link">rweibull</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">10000000</span>,</span>
<span>           shape<span class="op">=</span><span class="va">sim.shape</span>,</span>
<span>           scale<span class="op">=</span><span class="va">sim.scale</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">10000000</span>,</span>
<span>        mean<span class="op">=</span><span class="fl">0</span>,</span>
<span>        sd<span class="op">=</span><span class="va">sim.err.sd</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>A density plot of the DGP is given by:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">dgp.density</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "density"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dgp.density</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Density of the DGP"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"System Lifetime"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Density"</span>,</span>
<span>     col<span class="op">=</span><span class="st">"light blue"</span>,</span>
<span>     lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="weibull-mle_files/figure-html/unnamed-chunk-3-1.png" width="700" style="display: block; margin: auto;"></p>
<p>A few elements from the sample are given by:</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 58 × 1</span></span></span>
<span><span class="co">#&gt;    lifetime</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     3.46</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2.64</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     2.58</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     2.55</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     2.03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     2.47</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     4.02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     3.13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     2.44</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     2.75</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 48 more rows</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="visualizing-the-data">Visualizing the data<a class="anchor" aria-label="anchor" href="#visualizing-the-data"></a>
</h2>
<p>Visualizing the data is a good first step in the analysis of the data. If the data is univariate or bivariate, we can plot a histogram of the data pretty easily (if it’s multivariate, we can plot the marginal distributions of the data).</p>
<p>We show a histogram of the simulated data below: <img src="weibull-mle_files/figure-html/histo-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="parametrically-modeling-the-data">Parametrically modeling the data<a class="anchor" aria-label="anchor" href="#parametrically-modeling-the-data"></a>
</h2>
<p>If we only had this sample, what might we conclude? This can be a very difficult problem. In our case, we know that the simulated data is drawn from the distribution <span class="math inline">\(T_i = W_i + \epsilon_i\)</span> where <span class="math display">\[
  W_i \sim \operatorname{weibull}(\lambda = 5,
                                k = 3)
\]</span> and <span class="math display">\[
  \epsilon_i \sim \operatorname{normal}(\mu=0,\sigma=0.05).
\]</span> However, in real-world data sets, we do not know the distribution. So, let us suppose that we do not know the true distribution of the data.</p>
<p>If we were only interested in, say, <em>prediction</em>, and we had a sufficiently large sample, we could use a non-parametric methods and “let the data speak for itself.” However, if we are interested in inference (e.g., explaining the data) or the sample was small, then we need to make some assumptions about the data.</p>
<p>In this case, we will assume that the data is drawn from a parametric distribution. There are many well-known, named parametric distributions, e.g., Pareto, Weibull, and Normal, to name a few. From experience, it seems like the Weibull and the normal might be good fits to the data. However, note that since the normal distribution permits negative values to be realized, it may not be an appropriate choice. Still, since these are only approximations anyway, this may not be a big deal.</p>
<p>First, let us fit the Weibull distribution by choosing appropriate shape <span class="math inline">\(\lambda\)</span> and scale <span class="math inline">\(k\)</span> parameters using the maximum likelihood estimator.</p>
<p>To find the MLE of <span class="math inline">\(\theta = (\lambda,k)'\)</span>, we need the log-likelihood function <code>l.wei</code>, which is given by the following R code:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l.wei</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html" class="external-link">dweibull</a></span><span class="op">(</span><span class="va">sim.df</span><span class="op">$</span><span class="va">lifetime</span>,</span>
<span>                                      shape<span class="op">=</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                                      scale<span class="op">=</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                                      log<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>An MLE is a point <span class="math inline">\((\hat\lambda,\hat k)'\)</span> that is a maximum of the loglikelihood function, <code>l.wei</code>, over the parameter’s domain. We may use the root-finding algorithm known as the Newton-Raphson method to find where the gradient of the log-likelihood function <code>l.wei</code> is zero.</p>
<p>Here is the Newton-raphson code:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newton_raphson</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span>, <span class="va">df</span>, <span class="va">x0</span>, <span class="va">tol</span><span class="op">=</span><span class="fl">1e-4</span>, <span class="va">maxiter</span><span class="op">=</span><span class="fl">100L</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">fx</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">x0</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">maxiter</span><span class="op">)</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">fx</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tol</span><span class="op">)</span> <span class="kw">break</span></span>
<span>    <span class="va">J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html" class="external-link">df</a></span><span class="op">(</span><span class="va">x0</span><span class="op">)</span></span>
<span>    <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">J</span>,<span class="va">fx</span><span class="op">)</span></span>
<span>    <span class="va">x0</span> <span class="op">&lt;-</span> <span class="va">x0</span> <span class="op">-</span> <span class="va">d</span></span>
<span>    <span class="va">fx</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">x0</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">x0</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The Newton-Raphson function is conventionally used to minimize a function. We’re trying to maximize the log-likelihood function <code>l.wei</code>, and so we’re trying to minimize the negative of the log-likelihood. Thus, the gradient and Hessian is given by the negative of each.</p>
<p>Here’s the code:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">newton_raphson</span><span class="op">(</span></span>
<span>    f<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/grad.html" class="external-link">grad</a></span><span class="op">(</span><span class="va">l.wei</span>,<span class="va">theta</span><span class="op">)</span>,</span>
<span>    df<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/hessian.html" class="external-link">hessian</a></span><span class="op">(</span><span class="va">l.wei</span>,<span class="va">theta</span><span class="op">)</span>,</span>
<span>    x0<span class="op">=</span><span class="va">sim.theta</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 6.140381 3.034467</span></span></code></pre></div>
<p>The gradient should be approximately zero at the MLE. The Hessian is also useful, since asymptotically the MLE follows a normal distribution with a mean given by the true parameter and a variance-covariance given by the negative inverse of the Hessian.</p>
<p>We have implemented more precise and more efficient algorithms for computing the MLE of the Weibull distribution in the <code>algebraic.mle</code> R package.</p>
<p>This function, <code>mle_weibull_shape_scale</code>, returns an <code>mle</code> object, which has an API that provides a number of conventient methods, such as estimating the variance-covariance matrix, confidence intervals, bias, and so on. Here’s the code:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/queelius/algebraic.mle" class="external-link">algebraic.mle</a></span><span class="op">)</span></span>
<span><span class="va">mle.wei</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mle_weibull_shape_scale.html">mle_weibull_shape_scale</a></span><span class="op">(</span><span class="va">sim.df</span><span class="op">$</span><span class="va">lifetime</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mle.wei</span><span class="op">)</span></span>
<span><span class="co">#&gt; Maximum likelihood estimator of type mle_weibull_shape_scale is normally distributed.</span></span>
<span><span class="co">#&gt; The estimates of the parameters are given by:</span></span>
<span><span class="co">#&gt;    shape    scale </span></span>
<span><span class="co">#&gt; 6.140382 3.034467 </span></span>
<span><span class="co">#&gt; The fisher information matrix (FIM) is given by:</span></span>
<span><span class="co">#&gt;          shape     scale</span></span>
<span><span class="co">#&gt; shape  2.91748  18.65922</span></span>
<span><span class="co">#&gt; scale 18.65922 314.84968</span></span>
<span><span class="co">#&gt; The variance-covariance matrix of the estimator is given by:</span></span>
<span><span class="co">#&gt;             shape        scale</span></span>
<span><span class="co">#&gt; shape  0.55197963 -0.032712474</span></span>
<span><span class="co">#&gt; scale -0.03271247  0.005114788</span></span>
<span><span class="co">#&gt; The asymptotic 95% confidence interval of the parameters are given by:</span></span>
<span><span class="co">#&gt;           2.5%    97.5%</span></span>
<span><span class="co">#&gt; shape 4.918333 7.362432</span></span>
<span><span class="co">#&gt; scale 2.916831 3.152104</span></span>
<span><span class="co">#&gt; The bias of the estimator is given by:</span></span>
<span><span class="co">#&gt; [1] 0 0</span></span>
<span><span class="co">#&gt; The MSE of the estimator is  0.5570944 .</span></span>
<span><span class="co">#&gt; The log-likelihood is  -44.58054 .</span></span>
<span><span class="co">#&gt; The AIC is  93.16108 .</span></span>
<span><span class="co">#&gt; The standard error is  0.7429533 0.07151775 .</span></span></code></pre></div>
<p>Let’s do the same for the normal distribution. We will simply use the <code>mle_normal_mu_var</code> function from the <code>algebraic.mle</code> package:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mle.norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mle_normal_mu_var.html">mle_normal_mu_var</a></span><span class="op">(</span><span class="va">sim.df</span><span class="op">$</span><span class="va">lifetime</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mle.norm</span><span class="op">)</span></span>
<span><span class="co">#&gt; Maximum likelihood estimator of type mle_normal_mu_var is normally distributed.</span></span>
<span><span class="co">#&gt; The estimates of the parameters are given by:</span></span>
<span><span class="co">#&gt;        mu       var </span></span>
<span><span class="co">#&gt; 2.8220016 0.2756513 </span></span>
<span><span class="co">#&gt; The fisher information matrix (FIM) is given by:</span></span>
<span><span class="co">#&gt;          [,1]     [,2]</span></span>
<span><span class="co">#&gt; [1,] 210.4108   0.0000</span></span>
<span><span class="co">#&gt; [2,]   0.0000 381.6612</span></span>
<span><span class="co">#&gt; The variance-covariance matrix of the estimator is given by:</span></span>
<span><span class="co">#&gt;             [,1]        [,2]</span></span>
<span><span class="co">#&gt; [1,] 0.004752608 0.000000000</span></span>
<span><span class="co">#&gt; [2,] 0.000000000 0.002620125</span></span>
<span><span class="co">#&gt; The asymptotic 95% confidence interval of the parameters are given by:</span></span>
<span><span class="co">#&gt;          2.5%     97.5%</span></span>
<span><span class="co">#&gt; mu  2.7086068 2.9353964</span></span>
<span><span class="co">#&gt; var 0.1914559 0.3598466</span></span>
<span><span class="co">#&gt; The bias of the estimator is given by:</span></span>
<span><span class="co">#&gt;                       var </span></span>
<span><span class="co">#&gt;  0.000000000 -0.004752608 </span></span>
<span><span class="co">#&gt; The MSE of the estimator is  0.00739532 .</span></span>
<span><span class="co">#&gt; The log-likelihood is  -44.92849 .</span></span>
<span><span class="co">#&gt; The AIC is  93.85698 .</span></span>
<span><span class="co">#&gt; The standard error is  0.06893916 0.05118715 .</span></span></code></pre></div>
<p>Let’s plot the pdfs of the Weibull and normal distributions:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html" class="external-link">dweibull</a></span><span class="op">(</span><span class="va">x</span>,shape<span class="op">=</span><span class="fu"><a href="../reference/point.html">point</a></span><span class="op">(</span><span class="va">mle.wei</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,scale<span class="op">=</span><span class="fu"><a href="../reference/point.html">point</a></span><span class="op">(</span><span class="va">mle.wei</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>     xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4.5</span><span class="op">)</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.82</span><span class="op">)</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Densities"</span>, col<span class="op">=</span><span class="st">"green"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"t"</span>, ylab<span class="op">=</span><span class="st">"density"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># overlay the normal distribution pdf on the Weibull pdf plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>,mean<span class="op">=</span><span class="fu"><a href="../reference/point.html">point</a></span><span class="op">(</span><span class="va">mle.norm</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="../reference/point.html">point</a></span><span class="op">(</span><span class="va">mle.norm</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      add<span class="op">=</span><span class="cn">T</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">dgp.density</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="weibull-mle_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>In black, we have the true density. In green, we have the Weibull density. In red, we have the normal density. From the plot, it’s hard to tell which distribution is a better fit to the DGP.</p>
<p>How do we choose between the Weibull and the normal distribution? We will discuss this in the next section.</p>
</div>
<div class="section level2">
<h2 id="goodness-of-fit">Goodness of fit<a class="anchor" aria-label="anchor" href="#goodness-of-fit"></a>
</h2>
<p>We are fitting a model to the data that does not precisely capture the generative model <span class="math inline">\(W\)</span>. So, how good of a fit is it?</p>
<p>We will conduct a goodness of fit test, <span class="math display">\[\begin{align}
  H_0 &amp;: \text{the data is compatible with the Weibull distribution}\\
  H_A &amp;: \text{the data is not compatible with the Weibull distribution}.
\end{align}\]</span></p>
<p>To perform this test, we will use the Cramer-von Mises test. This test is based on the Cramer-von Mises statistic, which is a measure of the distance between the empirical distribution function of the data and the distribution function of the model. The Cramer-von Mises statistic is given by <span class="math display">\[
  \hat D_n^2 = \frac{1}{n}\sum_{i=1}^n \left(\hat F_n(x_i) - F(x_i)\right)^2
\]</span> where <span class="math inline">\(\hat F_n\)</span> is the empirical distribution function of the data and <span class="math inline">\(F\)</span> is the distribution function of the model.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cramer.test</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">obs.dat</span>,<span class="va">ref.dat</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">stat</span> <span class="op">&lt;-</span> <span class="fu">CDFt</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/CDFt/man/CramerVonMisesTwoSamples.html" class="external-link">CramerVonMisesTwoSamples</a></span><span class="op">(</span><span class="va">obs.dat</span>,<span class="va">ref.dat</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>p.value<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">stat</span><span class="op">)</span><span class="op">/</span><span class="fl">6.0</span>,</span>
<span>       cramer.stat<span class="op">=</span><span class="va">stat</span>,</span>
<span>       obs.size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">obs.dat</span><span class="op">)</span>,</span>
<span>       ref.size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ref.dat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">wei.shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/point.html">point</a></span><span class="op">(</span><span class="va">mle.wei</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">wei.scale</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/point.html">point</a></span><span class="op">(</span><span class="va">mle.wei</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">ref.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html" class="external-link">rweibull</a></span><span class="op">(</span><span class="fl">1000000</span>,shape<span class="op">=</span><span class="va">wei.shape</span>,scale<span class="op">=</span><span class="va">wei.scale</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/cramer.test.html">cramer.test</a></span><span class="op">(</span><span class="va">sim.df</span><span class="op">$</span><span class="va">lifetime</span>,<span class="va">ref.dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; $p.value</span></span>
<span><span class="co">#&gt; [1] 0.1589732</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $cramer.stat</span></span>
<span><span class="co">#&gt; [1] 0.04726002</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $obs.size</span></span>
<span><span class="co">#&gt; [1] 58</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ref.size</span></span>
<span><span class="co">#&gt; [1] 1000000</span></span></code></pre></div>
<p>Looking at the <span class="math inline">\(p\)</span>-value, we see that the data is compatible with the Weibull distribution. Now, let’s do the same for the normal distribution:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">norm.mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/point.html">point</a></span><span class="op">(</span><span class="va">mle.norm</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">norm.var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/point.html">point</a></span><span class="op">(</span><span class="va">mle.norm</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">ref.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span>,mean<span class="op">=</span><span class="va">norm.mu</span>,sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">norm.var</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/cramer.test.html">cramer.test</a></span><span class="op">(</span><span class="va">sim.df</span><span class="op">$</span><span class="va">lifetime</span>,<span class="va">ref.dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; $p.value</span></span>
<span><span class="co">#&gt; [1] 0.1569756</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $cramer.stat</span></span>
<span><span class="co">#&gt; [1] 0.05990535</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $obs.size</span></span>
<span><span class="co">#&gt; [1] 58</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ref.size</span></span>
<span><span class="co">#&gt; [1] 1000000</span></span></code></pre></div>
<p>They are both compatible with the data. However, the Weibull distribution has a larger <span class="math inline">\(p\)</span>-value, which may suggest it is a better fit. We also have the AIC measure of goodness of fit. The AIC is given by <span class="math display">\[
  \text{AIC} = -2\log L + 2k,
\]</span> where <span class="math inline">\(L\)</span> is the likelihood of the model and <span class="math inline">\(k\)</span> is the number of parameters in the model. The AIC is a measure of the tradeoff between the goodness of fit and the complexity of the model.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/aic.html">aic</a></span><span class="op">(</span><span class="va">mle.wei</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 93.16108</span></span>
<span><span class="fu"><a href="../reference/aic.html">aic</a></span><span class="op">(</span><span class="va">mle.norm</span><span class="op">)</span></span>
<span><span class="co">#&gt;      var </span></span>
<span><span class="co">#&gt; 93.85698</span></span></code></pre></div>
<p>A lower AIC value indicates a better fit. Thus, according to this measure, the Weibull distribution is the better fit.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>In this post, we have shown how to fit a Weibull distribution to data. We have also shown how to fit a normal distribution to the same data. We have shown how to compare the two models using the Cramer-von Mises test and the AIC measure of goodness of fit.</p>
<p>We came to no definitive conclusion about which model is better, but the Weibull distribution has a larger <span class="math inline">\(p\)</span>-value from the Cramer-von Mises test, and a lower AIC value. Thus, it may be the better fit, but we see that the true DGP is visually different from both the Weibull and the normal distributions. Notably, the DGP has longer tails than both, suggesting that an even better fit may be a long-tail distribution like the log-normal or the Pareto distribution.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Alexander Towell.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
